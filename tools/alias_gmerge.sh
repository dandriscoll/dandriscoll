git config --global alias.gmerge '!f(){ set -eu; run(){ echo "+ $*"; "$@"; }; target="${1:?Usage: git gmerge <target-branch>}"; cur="$(git rev-parse --abbrev-ref HEAD)"; [ "$cur" != "HEAD" ] || { echo "Detached HEAD; checkout a branch first" >&2; exit 6; }; git show-ref --verify --quiet "refs/heads/$target" || { echo "No such local branch: $target" >&2; exit 3; }; git diff --quiet && git diff --cached --quiet || { echo "Working tree not clean (commit/stash first)" >&2; exit 4; }; run git switch "$target"; run git merge --no-edit "$cur" || { echo "Merge failed (likely conflict). You are on '$target'." >&2; exit 5; }; run git push; run git switch "$cur"; }; f'
